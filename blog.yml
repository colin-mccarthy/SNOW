---
- name: create ticket with notes
  hosts: localhost
  gather_facts: no
  connection: local

  tasks:
  - name: include vars
    include_vars: incident_vars.yml

  - name: Create a change request
    snow_record:
      state: present
      table: change_request
      username: "{{ SN_USERNAME }}"
      password: "{{ SN_PASSWORD }}"
      instance: "{{ SN_INSTANCE }}"
      data:
        priority: "{{ priority}}"
        short_description: "This is a test opened by Ansible"
        state: -4
    register: new_incident

  - debug: var=new_incident.record.number
